var E=Object.defineProperty;var C=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var I=(e,a,t)=>a in e?E(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,B=(e,a)=>{for(var t in a||(a={}))O.call(a,t)&&I(e,t,a[t]);if(C)for(var t of C(a))V.call(a,t)&&I(e,t,a[t]);return e};var p=(e,a,t)=>new Promise((f,c)=>{var g=n=>{try{l(t.next(n))}catch(i){c(i)}},s=n=>{try{l(t.throw(n))}catch(i){c(i)}},l=n=>n.done?f(n.value):Promise.resolve(n.value).then(g,s);l((t=t.apply(e,a)).next())});import{B as j,b as U,a as A}from"./index-6bb63bf0.js";import{_ as W}from"./BasicForm.vue_vue_type_script_setup_true_lang-b5fd2c2d.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1d0165cd.js";import{u as z}from"./useForm-d2875f1c.js";import{c as G,s as Q}from"./dept-92794b55.js";import{g as Z}from"./company-7689c9fc.js";import H from"./index-d0acc860.js";import{F as J}from"./constantEnum-c819fa5f.js";import{B as K,Q as X}from"./antd-bebda08e.js";import{d as Y,f as N,u as w,c as ee,a6 as u,Z as M,a7 as F,a8 as y,l as _,E as v,a0 as L,aa as te,ab as oe}from"./vue-f7f38239.js";import{c as ae}from"./index.js";const Se=[{title:"名称",dataIndex:"name",align:"left"},{title:"编码",dataIndex:"code",width:120,align:"left"},{title:"部门领导",dataIndex:"leaderName",width:120,align:"left",customRender:({record:e})=>e.leaderCode?`${e.leaderName||""}[${e.leaderCode}]`:"未设置"},{title:"所属公司",dataIndex:"companyName",width:120,align:"left"},{title:"创建时间",dataIndex:"createTime",width:180}],we=[{field:"keyword",label:"关键字",component:"Input",componentProps:{placeholder:"请输入名称/标识"},labelWidth:60,colProps:{span:6,lg:{span:8,offset:0},sm:{span:14,offset:0},xs:{span:16,offset:0}}}],ne=[{field:"id",label:"ID",required:!1,component:"Input",show:!1},{field:"pid",label:"pid",required:!1,component:"Input",show:!1},{field:"name",label:"名称",component:"Input",required:!0,rules:[{required:!0,whitespace:!0,message:"名称不能为空！"},{max:100,message:"字符长度不能大于100！"}],colProps:{span:24}},{field:"code",label:"编码",component:"Input",required:!0,colProps:{span:24}},{field:"leaderCode",label:"部门领导",component:"Input",slot:"settingLeader",required:!1,colProps:{span:24}},{field:"leaderName",label:"部门领导",component:"Input",show:!1},{field:"companyId",label:"所属公司",component:"TreeSelect",componentProps:{treeNodeFilterProp:"cname",replaceFields:{title:"cname",key:"id",value:"id"},getPopupContainer:()=>document.body},required:!0,colProps:{span:24}},{field:"orderNo",label:"排序号",required:!1,component:"InputNumber"},{label:"备注",field:"note",component:"InputTextArea",rules:[{max:256,message:"字符长度不能大于256！"}],colProps:{span:24}}],re=Y({name:"DeptModal",components:{BasicModal:j,BasicForm:W,PersonalSelector:H,Button:K,Tag:X},emits:["success","register"],setup(e,{emit:a}){const t=N(!0),[f,{openModal:c,setModalProps:g}]=U(),s=N([]),[l,{setFieldsValue:n,updateSchema:i,resetFields:P,validate:m}]=z({labelWidth:100,schemas:ne,showActionButtonGroup:!1,actionColOptions:{span:23}}),h=o=>[{trigger:"blur",validator:(d,r)=>r?G({id:o.id,field:o.field,fieldValue:r,fieldName:o.fieldName}).then(S=>S?Promise.resolve():Promise.reject(o.fieldName+"已存在，请修改！")).catch(S=>Promise.reject(S)):Promise.resolve()}],[k,{setModalProps:b,closeModal:x}]=A(o=>p(this,null,function*(){yield P(),b({confirmLoading:!1}),t.value=!!(o!=null&&o.isUpdate);const d=yield Z();let r=o.record;r.id&&r.leaderCode?s.value=[{code:r.leaderCode,name:r.leaderName}]:s.value=[],yield i([{field:"companyId",componentProps:{treeData:d}},{field:"code",dynamicRules:()=>[{required:!0,whitespace:!0,message:"编码不能为空！"},{pattern:new RegExp(J.SN),type:"string",message:"请输入英文或数字！"},{max:64,message:"字符长度不能大于64！"},...h({id:w(t)&&r&&r.id||"",field:"code",fieldValue:"",fieldName:"编码"})]}]),w(t)?n(B({},o.record)):r.companyId&&n({companyId:r.companyId})})),D=ee(()=>w(t)?"修改部门":"新增部门");function R(){c(!0,{selectorProps:{multiSelect:!1,selectedList:s.value}}),g({title:"设置部门领导",bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}function T(o){return p(this,null,function*(){s.value=o.map(d=>({id:d.id,code:d.code,name:d.name})),o&&o.length>0?n({leaderCode:o[0].code,leaderName:o[0].name}):n({leaderCode:"",leaderName:""})})}function q(){return p(this,null,function*(){n({leaderCode:"",leaderName:""}),s.value=[]})}function $(){return p(this,null,function*(){try{b({confirmLoading:!0});const o=yield m();yield Q(o),x(),a("success")}finally{b({confirmLoading:!1})}})}return{registerModal:k,registerForm:l,getTitle:D,registerPersonalModal:f,selectedPersonList:s,handleDeleteLeader:q,handleSettingLeader:R,handleSubmit:$,handleSettingLeaderSuccess:T}}});function se(e,a,t,f,c,g){const s=u("Tag"),l=u("Button"),n=u("BasicForm"),i=u("PersonalSelector"),P=u("BasicModal");return M(),F(P,oe(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:y(()=>[_(n,{onRegister:e.registerForm},{settingLeader:y(({model:m,field:h})=>[m[h]?(M(),F(s,{key:0,closable:"",onClose:e.handleDeleteLeader},{default:y(()=>[v(L(m.leaderName)+"["+L(m[h])+"] ",1)]),_:2},1032,["onClose"])):te("",!0),_(l,{style:{width:"110px"},type:"link",onClick:e.handleSettingLeader},{default:y(()=>[v("设置领导")]),_:1},8,["onClick"])]),_:1},8,["onRegister"]),_(i,{onRegister:e.registerPersonalModal,onSuccess:e.handleSettingLeaderSuccess},null,8,["onRegister","onSuccess"])]),_:1},16,["onRegister","title","onOk"])}const le=ae(re,[["render",se]]),_e=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));export{le as D,_e as a,Se as c,we as s};
