var E=(e,b,p)=>new Promise((f,y)=>{var T=n=>{try{s(p.next(n))}catch(r){y(r)}},u=n=>{try{s(p.throw(n))}catch(r){y(r)}},s=n=>n.done?f(n.value):Promise.resolve(n.value).then(T,u);s((p=p.apply(e,b)).next())});import{_ as z}from"./BasicTable.vue_vue_type_script_setup_true_lang-68f7da80.js";import"./TableImg.vue_vue_type_style_index_0_lang-c025c7d6.js";import{a as N}from"./BasicForm.vue_vue_type_style_index_0_lang-1d0165cd.js";import{u as H}from"./useTable-dd83d9cb.js";import{d as Q,e as Z,h as q,i as G,g as J,a as X,j as Y,k as ee,l as te}from"./flowListener-2ad3f78d.js";import{P as oe}from"./index-5a8cda67.js";import ne from"./ListenerModal-93cfd381.js";import ae from"./ListenerPropertiesModal-ea538255.js";import{b as A}from"./index-6bb63bf0.js";import{d as se,f as g,o as ie,u as P,a6 as c,Z as m,a7 as C,a8 as l,l as _,E as M,aa as h,_ as D,F as $,a0 as R}from"./vue-f7f38239.js";import{Q as re}from"./antd-bebda08e.js";import{c as le}from"./index.js";import"./BasicForm.vue_vue_type_script_setup_true_lang-b5fd2c2d.js";import"./useForm-d2875f1c.js";import"./uuid-31b8b5a4.js";import"./sortable.esm-4ae27e0b.js";import"./onMountedOrActivated-a837e8fb.js";import"./useWindowSizeFn-01ffbee2.js";import"./index-1b9aa1da.js";import"./useSortable-9ec2a7be.js";import"./download-2647fd8d.js";import"./base64Conver-39fc0d26.js";import"./index-b34be3ab.js";import"./IconPicker.vue_vue_type_script_setup_true_lang-af62677b.js";import"./copyTextToClipboard-ad844e61.js";import"./index-091b1c05.js";import"./useContentViewHeight-4f74c208.js";const pe=se({name:"FlowListener",components:{PageWrapper:oe,Tag:re,BasicTable:z,TableAction:N,ListenerModal:ne,ListenerPropertiesModal:ae},setup(){const[e,{openModal:b,setModalProps:p}]=A(),f=g({}),y=g({}),T=g({}),u=g(!1),s=g([]),n=g({}),[r,{openModal:k,setModalProps:S}]=A(),[w,{reload:i,getForm:a,setProps:v}]=H({title:"列表",api:Q,columns:Z,formConfig:{labelWidth:80,schemas:q,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},expandedRowKeys:s,expandRowByClick:!0,useSearchForm:!0,bordered:!0,showIndexColumn:!0,showTableSetting:!1,rowKey:"id",canResize:!0,onExpand:(t,o)=>{t?(s.value=[o.id],n.value=o,F(o.id)):s.value=[]},actionColumn:{width:150,title:"操作",dataIndex:"action"}});function F(t){u.value=!0,G({listenerId:t}).then(o=>{o&&o.length>0?f.value[t]=o:f.value[t]=[]}).finally(()=>{u.value=!1})}function B(){return E(this,null,function*(){const{validate:t}=a(),o=yield t();b(!0,{isUpdate:!1,record:{listenerType:o.listenerType||"taskListener"}}),p({title:"新增监听"})})}ie(()=>{J().then(o=>{o.forEach(d=>{P(y)[d.value]=d.label})});const{updateSchema:t}=a();X().then(o=>{o.forEach(d=>{P(T)[d.value]=d.label}),t([{field:"listenerType",componentProps:{options:o,onChange:Ve=>E(this,[Ve],function*({target:d}){const{setFieldsValue:W}=a();yield W({name:""}),v({searchInfo:{listenerType:d.value}}),i()})}}])})});function L(t,o){o.stopPropagation(),n.value=t,k(!0,{isUpdate:!1,record:{listenerId:t.id,type:"string"}}),S({title:`添加【${t.name}】的属性`})}function j(t){k(!0,{isUpdate:!0,record:t}),S({title:`修改【${t.name}】的属性`})}function I(t,o){o.stopPropagation(),b(!0,{record:t,isUpdate:!0})}function O(t,o){o.stopPropagation(),ee(t.id).then(()=>{i()})}function U(){setTimeout(()=>{i()},200)}function x(){return setTimeout(()=>{i()},200),Promise.resolve(!0)}function K(t){te(t.id).then(()=>{F(P(n).id)}).finally(()=>{})}function V(){F(P(n).id),s.value=[P(n).id]}return{registerTable:w,registerModal:e,registerPropertiesModal:r,expressionTypeObj:y,listenerTypeObj:T,propertiesColumns:Y,listenerPropertiesData:f,propertiesTableLoading:u,handleDeleteProperty:K,handleCloseFunc:x,handleCreate:B,handleEditProperties:j,handleAddProperties:L,handleEdit:I,handleDelete:O,handleSuccess:U,handleUpdateSecretKeySuccess:V}}});function ue(e,b,p,f,y,T){const u=c("a-button"),s=c("TableAction"),n=c("Tag"),r=c("BasicTable"),k=c("ListenerModal"),S=c("ListenerPropertiesModal"),w=c("PageWrapper");return m(),C(w,{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex"},{default:l(()=>[_(r,{onRegister:e.registerTable,class:"custom-listener-table"},{toolbar:l(()=>[_(u,{type:"primary",onClick:e.handleCreate},{default:l(()=>[M(" 新增 ")]),_:1},8,["onClick"])]),bodyCell:l(({column:i,record:a})=>[i.key==="action"?(m(),C(s,{key:0,actions:[{icon:"ant-design:plus-outlined",tooltip:"添加参数",onClick:e.handleAddProperties.bind(null,a)},{tooltip:"修改",icon:"clarity:note-edit-line",onClick:e.handleEdit.bind(null,a)},{tooltip:"删除",icon:"ant-design:delete-outlined",color:"error",onClick:v=>{v.stopPropagation()},popConfirm:{title:"是否确认删除",confirm:e.handleDelete.bind(null,a),placement:"left"}}]},null,8,["actions"])):h("",!0),i.key==="listenerType"?(m(),D($,{key:1},[a.listenerType==="taskListener"?(m(),C(n,{key:0,color:"default"},{default:l(()=>[M(R(e.listenerTypeObj[a.listenerType]),1)]),_:2},1024)):h("",!0),a.listenerType==="executionListener"?(m(),C(n,{key:1,color:"processing"},{default:l(()=>[M(R(e.listenerTypeObj[a.listenerType]),1)]),_:2},1024)):h("",!0)],64)):h("",!0),i.key==="type"?(m(),D($,{key:2},[M(R(e.expressionTypeObj[a.type]),1)],64)):h("",!0)]),expandedRowRender:l(({record:i,index:a,indent:v,expanded:F})=>[_(r,{title:"",size:"small",columns:e.propertiesColumns,useSearchForm:!1,immediate:!1,showIndexColumn:!0,showTableSetting:!1,bordered:!0,pagination:!1,emptyDataIsShowTable:!1,inset:!0,rowKey:"id",canResize:!1,loading:e.propertiesTableLoading,dataSource:e.listenerPropertiesData[i.id]},{bodyCell:l(({column:B,record:L})=>[B.key==="option"?(m(),C(s,{key:0,actions:[{icon:"clarity:note-edit-line",title:"编辑",onClick:e.handleEditProperties.bind(null,L)},{icon:"ant-design:delete-outlined",color:"error",title:"删除",popConfirm:{title:"是否确认删除",confirm:e.handleDeleteProperty.bind(null,L),placement:"left"}}]},null,8,["actions"])):h("",!0)]),_:2},1032,["columns","loading","dataSource"])]),_:1},8,["onRegister"]),_(k,{onRegister:e.registerModal,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),_(S,{onRegister:e.registerPropertiesModal,onSuccess:e.handleUpdateSecretKeySuccess,closeFunc:e.handleCloseFunc},null,8,["onRegister","onSuccess","closeFunc"])]),_:1})}const Ue=le(pe,[["render",ue]]);export{Ue as default};
