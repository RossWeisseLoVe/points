var R=Object.defineProperty;var w=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var E=(e,s,t)=>s in e?R(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,C=(e,s)=>{for(var t in s||(s={}))A.call(s,t)&&E(e,t,s[t]);if(w)for(var t of w(s))F.call(s,t)&&E(e,t,s[t]);return e};var J=(e,s,t)=>new Promise((o,d)=>{var v=c=>{try{r(t.next(c))}catch(n){d(n)}},i=c=>{try{r(t.throw(c))}catch(n){d(n)}},r=c=>c.done?o(c.value):Promise.resolve(c.value).then(v,i);r((t=t.apply(e,s)).next())});import{B as V,a as x}from"./index-6bb63bf0.js";import{P as W}from"./index-5a8cda67.js";import{a as q}from"./dept-92794b55.js";import{bF as O,c as G}from"./index.js";import{_ as Q}from"./index-f9546e03.js";import{Q as Z,G as j,bg as z}from"./antd-bebda08e.js";import{d as H,f,w as K,x as T,c as U,u as X,a6 as g,q as Y,Z as k,a7 as b,a8 as B,$ as ee,_ as te,F as le,a9 as ae,E as se,a0 as re,aa as ne,l as D,n as oe,ab as ie}from"./vue-f7f38239.js";import"./useWindowSizeFn-01ffbee2.js";import"./useContentViewHeight-4f74c208.js";import"./onMountedOrActivated-a837e8fb.js";import"./useContextMenu-b66322cd.js";const ce=H({props:{title:{type:String,default:"人员选择"}},name:"OrgSelector",components:{BasicModal:V,PageWrapper:W,Tag:Z,BasicTree:Q,Spin:j,CloseCircleOutlined:z},setup(e,{emit:s}){const t=f([]),o=f(!1),d=f([]),v=f(!1),i=f([]),r=f([]),c=f(null);function n(){const l=X(c);if(!l)throw new Error("tree is null!");return l}K(r,(l,u)=>{if(o.value){const m=l.map(p=>{let a=O(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return a=C({},a),delete a.children,a});T(()=>{t.value=JSON.parse(JSON.stringify(m)),n().setCheckedKeys(l)})}else{const m=l.map(p=>{let a=O(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return a=C({},a),delete a.children,a});T(()=>{t.value=JSON.parse(JSON.stringify(m)),n().setSelectedKeys(l)})}},{immediate:!0,deep:!0}),K(i,(l,u)=>{if(!o.value){const m=l.map(p=>{let a=O(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return a=C({},a),delete a.children,a});T(()=>{t.value=JSON.parse(JSON.stringify(m)),n().setSelectedKeys(l)})}},{immediate:!0,deep:!0});const[y,{setModalProps:_,closeModal:S}]=x(l=>J(this,null,function*(){const{selectorProps:u}=l;v.value=!0,o.value=u.multiSelect,q().then(m=>{d.value=m;let p=u.selectedList.map(a=>a.id);o.value?(r.value=p,setTimeout(()=>{n().setCheckedKeys(r.value),n().setExpandedKeys(r.value)},200)):(i.value=p,setTimeout(()=>{n().setSelectedKeys(i.value),n().setExpandedKeys(i.value)},200))}).finally(()=>{v.value=!1}),_({wrapClassName:"selector-content"})}));function N(l){o.value?r.value=JSON.parse(JSON.stringify(l.checked)):r.value=JSON.parse(JSON.stringify(l.checked.length>0?[l.checked[0]]:[]))}function M(l){o.value||(i.value=l)}const P=U(()=>"选择人员");function L(){o.value?r.value=[]:i.value=[]}function $(l){o.value?r.value.splice(r.value.findIndex(u=>u===l),1):i.value.splice(i.value.findIndex(u=>u===l),1)}function I(){s("success",t),S()}return{treeRef:c,multiSelect:o,treeData:d,treeLoading:v,registerModal:y,getTitle:P,selectedList:t,removeAllSelected:L,removeSelectedItem:$,handleSubmit:I,handleCheck:N,handleSelect:M}}});const de={class:"selected-items"};function ue(e,s,t,o,d,v){const i=g("Tag"),r=g("CloseCircleOutlined"),c=g("BasicTree"),n=g("PageWrapper"),y=g("BasicModal"),_=Y("loading");return k(),b(y,ie({wrapClassName:"selector-body org "},e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:B(()=>[ee("div",de,[(k(!0),te(le,null,ae(e.selectedList,S=>(k(),b(i,{color:"processing",closable:"",onClose:N=>{N.preventDefault(),e.removeSelectedItem(S.id)}},{default:B(()=>[se(re(S.shortName),1)]),_:2},1032,["onClose"]))),256)),e.selectedList.length>0?(k(),b(r,{key:0,class:"close-all",title:"清空",onClick:e.removeAllSelected},null,8,["onClick"])):ne("",!0)]),D(n,{dense:"",contentClass:"flex"},{default:B(()=>[oe(D(c,{ref:"treeRef",class:"w-4/4 org-tree",title:"组织",search:"",clickRowToExpand:!1,treeData:e.treeData,replaceFields:{key:"id",title:"shortName"},onCheck:e.handleCheck,onSelect:e.handleSelect,checkable:!!e.multiSelect,selectable:!e.multiSelect,checkStrictly:!0,autoExpandParent:""},null,8,["treeData","onCheck","onSelect","checkable","selectable"]),[[_,e.treeLoading]])]),_:1})]),_:1},16,["onRegister","title","onOk"])}const Oe=G(ce,[["render",ue]]);export{Oe as default};
