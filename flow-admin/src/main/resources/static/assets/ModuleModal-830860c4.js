var v=Object.defineProperty,R=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var _=(t,s,e)=>s in t?v(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,M=(t,s)=>{for(var e in s||(s={}))P.call(s,e)&&_(t,e,s[e]);if(w)for(var e of w(s))k.call(s,e)&&_(t,e,s[e]);return t},B=(t,s)=>R(t,$(s));var p=(t,s,e)=>new Promise((c,l)=>{var u=o=>{try{a(e.next(o))}catch(m){l(m)}},i=o=>{try{a(e.throw(o))}catch(m){l(m)}},a=o=>o.done?c(o.value):Promise.resolve(o.value).then(u,i);a((e=e.apply(t,s)).next())});import{B as N,a as V}from"./index-6bb63bf0.js";import{_ as C}from"./BasicForm.vue_vue_type_script_setup_true_lang-b5fd2c2d.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1d0165cd.js";import{u as E}from"./useForm-d2875f1c.js";import{f as L,c as O,s as U}from"./module-b7c977cb.js";import{d as j,f as x,u as g,c as A,a6 as y,Z as D,a7 as T,a8 as Z,l as q,ab as z}from"./vue-f7f38239.js";import{c as G}from"./index.js";import"./antd-bebda08e.js";import"./useWindowSizeFn-01ffbee2.js";import"./index-1b9aa1da.js";import"./uuid-31b8b5a4.js";import"./useSortable-9ec2a7be.js";import"./download-2647fd8d.js";import"./base64Conver-39fc0d26.js";import"./index-b34be3ab.js";import"./IconPicker.vue_vue_type_script_setup_true_lang-af62677b.js";import"./copyTextToClipboard-ad844e61.js";import"./index-091b1c05.js";const I=j({name:"ModuleModal",components:{BasicModal:N,BasicForm:C},emits:["success","register"],setup(t,{emit:s}){const e=x(!0),[c,{resetFields:l,setFieldsValue:u,updateSchema:i,validate:a}]=E({labelWidth:100,schemas:L,showActionButtonGroup:!1}),o=r=>[{trigger:"blur",validator:(n,h)=>h?O({id:r.id,field:r.field,fieldValue:h,fieldName:r.fieldName}).then(f=>f?Promise.resolve():Promise.reject(r.fieldName+"已存在，请修改！")).catch(f=>Promise.reject(f)):Promise.resolve()}],[m,{setModalProps:d,closeModal:F}]=V(r=>p(this,null,function*(){yield l(),d({confirmLoading:!1}),e.value=!!(r!=null&&r.isUpdate);let n=r.record;yield i([{field:"sn",dynamicRules:()=>[{required:!0,whitespace:!0,message:"标识不能为空！"},{trigger:["change","blur"],pattern:new RegExp("^[0-9a-zA-Z_]{1,}$"),type:"string",message:"请输入英文或数字！"},{trigger:["change","blur"],max:64,message:"字符长度不能大于64！"},...o({id:g(e)&&n&&n.id||"",field:"sn",fieldValue:"",fieldName:"标识"})]}]),g(e)&&u(B(M({},n),{status:n.status===1,showStatus:n.showStatus===1})),r.record.id?i([{field:"component",show:!1},{field:"url",show:!1}]):i([{field:"component",show:!0},{field:"url",show:!0}])})),S=A(()=>g(e)?"修改":"新增");function b(){return p(this,null,function*(){try{d({confirmLoading:!0});const r=yield a();r.status=r.status?1:0,r.showStatus=r.showStatus?1:0,yield U(r),F(),s("success")}finally{d({confirmLoading:!1})}})}return{registerModal:m,registerForm:c,getTitle:S,handleSubmit:b}}});function W(t,s,e,c,l,u){const i=y("BasicForm"),a=y("BasicModal");return D(),T(a,z(t.$attrs,{onRegister:t.registerModal,title:t.getTitle,onOk:t.handleSubmit}),{default:Z(()=>[q(i,{onRegister:t.registerForm},null,8,["onRegister"])]),_:1},16,["onRegister","title","onOk"])}const fe=G(I,[["render",W]]);export{fe as default};
