var W=Object.defineProperty,D=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var F=(e,a,s)=>a in e?W(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,R=(e,a)=>{for(var s in a||(a={}))H.call(a,s)&&F(e,s,a[s]);if(M)for(var s of M(a))Z.call(a,s)&&F(e,s,a[s]);return e},$=(e,a)=>D(e,P(a));var B=(e,a,s)=>new Promise((d,u)=>{var r=l=>{try{c(s.next(l))}catch(m){u(m)}},n=l=>{try{c(s.throw(l))}catch(m){u(m)}},c=l=>l.done?d(l.value):Promise.resolve(l.value).then(r,n);c((s=s.apply(e,a)).next())});import{B as j,a as q}from"./index-6bb63bf0.js";import{_ as J}from"./BasicTable.vue_vue_type_script_setup_true_lang-68f7da80.js";import"./TableImg.vue_vue_type_style_index_0_lang-c025c7d6.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1d0165cd.js";import{u as K}from"./useTable-dd83d9cb.js";import{_ as Q}from"./BasicForm.vue_vue_type_script_setup_true_lang-b5fd2c2d.js";import{u as X}from"./useForm-d2875f1c.js";import{a as Y,b as ee}from"./group.data-36b4110b.js";import{b as oe}from"./account-1d577ee4.js";import{A as ae,g as G,s as se}from"./AclCheckboxGroup-4d795a44.js";import{aA as w,c as te}from"./index.js";import{W as le,a4 as y}from"./antd-bebda08e.js";import{d as re,f,u as L,a6 as g,Z as ne,a7 as ce,a8 as k,l as A,$ as ie,E as ue,ab as me}from"./vue-f7f38239.js";import"./useWindowSizeFn-01ffbee2.js";import"./uuid-31b8b5a4.js";import"./sortable.esm-4ae27e0b.js";import"./onMountedOrActivated-a837e8fb.js";import"./index-1b9aa1da.js";import"./useSortable-9ec2a7be.js";import"./download-2647fd8d.js";import"./base64Conver-39fc0d26.js";import"./index-b34be3ab.js";import"./IconPicker.vue_vue_type_script_setup_true_lang-af62677b.js";import"./copyTextToClipboard-ad844e61.js";import"./index-091b1c05.js";const pe=y.Group,de=re({name:"SetAclModal",components:{BasicModal:j,BasicTable:J,BasicForm:Q,Select:le,Checkbox:y,CheckboxGroup:pe,AclCheckboxGroup:ae},emits:["success","register"],setup(e,{emit:a}){const s=f(!0),d=f(""),u=f([]),r=f(!0),n=f(!1),c=f(!1),[l,{setFieldsValue:m,updateSchema:_,resetFields:h,validate:v}]=X({labelWidth:100,schemas:Y,showActionButtonGroup:!1,actionColOptions:{span:0}}),[i,{getDataSource:b,setTableData:z,reload:he,expandAll:T}]=K({title:"",size:"small",dataSource:u,loading:r,immediate:!1,searchInfo:{},columns:ee,formConfig:{labelWidth:120},canResize:!0,maxHeight:400,isTreeTable:!0,useSearchForm:!1,showTableSetting:!1,bordered:!1,showIndexColumn:!1,pagination:!1}),[U,{setModalProps:S,closeModal:E}]=q(o=>B(this,null,function*(){if(h(),S({confirmLoading:!1,title:"给组【"+o.record.name+"("+o.record.sn+")】设置权限"}),s.value=!!(o!=null&&o.isUpdate),L(s)){let t=o.record.groups||[];t=t.map(p=>p.id),m($(R({},o.record),{groups:t})),d.value=o.record.id}r.value=!0,G({groupId:o.record.id}).then(t=>{I(t),u.value=t,r.value=!1,setTimeout(()=>{T()})})}));function I(o){let t=0,p=0,C=0;w(o,x=>{x.pvs&&x.pvs.forEach(O=>{t++,O.flag?p++:C++})}),p===t?(c.value=!0,n.value=!1):C===t?(c.value=!1,n.value=!1):n.value=!0}function V(){return B(this,null,function*(){try{S({confirmLoading:!0});const o=yield v();o.groups=o.groups.map(t=>({id:t})),o.userId=o.id,delete o.id,yield oe(o),E(),a("success")}finally{S({confirmLoading:!1})}})}function N(){G({groupId:d.value}).then(o=>{I(o)})}return{registerTable:i,registerModal:U,indeterminate:n,registerForm:l,checkAllBox:c,handelChangeCheckAllStatus:N,checkAll:o=>{r.value=!0,n.value=!1,se({checked:o.target.checked?1:0,aclInfo:{releaseId:L(d)}}).then(t=>{w(u.value,p=>{p.pvs&&p.pvs.forEach(C=>{C.flag=o.target.checked})}),z(u.value),r.value=!1,setTimeout(()=>{T()})}).catch(()=>{r.value=!1})},handleSubmit:V}}});function fe(e,a,s,d,u,r){const n=g("Checkbox"),c=g("AclCheckboxGroup"),l=g("BasicTable"),m=g("BasicForm"),_=g("BasicModal");return ne(),ce(_,me(e.$attrs,{onRegister:e.registerModal,onOk:e.handleSubmit}),{default:k(()=>[A(m,{onRegister:e.registerForm},{acls:k(({model:h,field:v})=>[A(l,{value:h[v],"onUpdate:value":i=>h[v]=i,onRegister:e.registerTable},{customTitle:k(()=>[ie("span",null,[A(n,{checked:e.checkAllBox,"onUpdate:checked":a[0]||(a[0]=i=>e.checkAllBox=i),indeterminate:e.indeterminate,onClick:e.checkAll},{default:k(()=>[ue("全选")]),_:1},8,["checked","indeterminate","onClick"])])]),pvs:k(({record:i})=>[A(c,{onChangeCheckAllStatus:e.handelChangeCheckAllStatus,checkboxList:i.pvs.map(b=>({label:b.name,value:b.position,checked:b.flag})),groupId:h.id,moduleSn:i.sn,moduleId:i.id},null,8,["onChangeCheckAllStatus","checkboxList","groupId","moduleSn","moduleId"])]),_:2},1032,["value","onUpdate:value","onRegister"])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","onOk"])}const De=te(de,[["render",fe]]);export{De as default};
