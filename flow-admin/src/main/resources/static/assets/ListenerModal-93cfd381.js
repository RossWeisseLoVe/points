var L=Object.defineProperty;var _=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var v=(s,t,e)=>t in s?L(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,B=(s,t)=>{for(var e in t||(t={}))R.call(t,e)&&v(s,e,t[e]);if(_)for(var e of _(t))$.call(t,e)&&v(s,e,t[e]);return s};var h=(s,t,e)=>new Promise((f,l)=>{var a=r=>{try{i(e.next(r))}catch(c){l(c)}},m=r=>{try{i(e.throw(r))}catch(c){l(c)}},i=r=>r.done?f(r.value):Promise.resolve(r.value).then(a,m);i((e=e.apply(s,t)).next())});import{B as k,a as N}from"./index-6bb63bf0.js";import{_ as x}from"./BasicForm.vue_vue_type_script_setup_true_lang-b5fd2c2d.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1d0165cd.js";import{u as C}from"./useForm-d2875f1c.js";import{f as E,g as S,a as V,c as O,s as U}from"./flowListener-2ad3f78d.js";import{d as j,f as D,u as M,c as q,a6 as w,Z as A,a7 as G,a8 as I,l as W,ab as Z}from"./vue-f7f38239.js";import{c as z}from"./index.js";import"./antd-bebda08e.js";import"./useWindowSizeFn-01ffbee2.js";import"./index-1b9aa1da.js";import"./uuid-31b8b5a4.js";import"./useSortable-9ec2a7be.js";import"./download-2647fd8d.js";import"./base64Conver-39fc0d26.js";import"./index-b34be3ab.js";import"./IconPicker.vue_vue_type_script_setup_true_lang-af62677b.js";import"./copyTextToClipboard-ad844e61.js";import"./index-091b1c05.js";const H=j({name:"ListenerModal",components:{BasicModal:k,BasicForm:x},emits:["success","register"],setup(s,{emit:t}){const e=D(!0),[f,{resetFields:l,updateSchema:a,setFieldsValue:m,validate:i}]=C({labelWidth:100,schemas:E,showActionButtonGroup:!1}),r=o=>[{trigger:"blur",validator:(u,p)=>p?O({id:o.id,field:o.field,fieldValue:p,fieldName:o.fieldName}).then(d=>d?Promise.resolve():Promise.reject(o.fieldName+"已存在，请修改！")).catch(d=>Promise.reject(d)):Promise.resolve()}],[c,{setModalProps:g,closeModal:b}]=N(o=>h(this,null,function*(){yield l(),g({confirmLoading:!1}),e.value=!!(o!=null&&o.isUpdate);let u=o.record;const p=yield S(),d=yield V(),y={};p.forEach(n=>{y[n.value]=n.label}),a({field:"value",label:y[u.type||"class"]}),yield a([{field:"name",dynamicRules:()=>[{required:!0,whitespace:!0,message:"名称不能为空！"},{max:80,message:"字符长度不能大于80！"},...r({id:M(e)&&u&&u.id||"",field:"name",fieldValue:"",fieldName:"名称"})]},{field:"type",componentProps:{options:p,onChange:n=>{let T=typeof n=="string"?n:n.target.value;a({field:"value",label:y[T]})}}},{field:"listenerType",componentProps:{options:d}}]),m(B({},o.record))})),F=q(()=>M(e)?"修改":"新增");function P(){return h(this,null,function*(){try{g({confirmLoading:!0});const o=yield i();yield U(o),b(),t("success")}finally{g({confirmLoading:!1})}})}return{registerModal:c,registerForm:f,getTitle:F,handleSubmit:P}}});function J(s,t,e,f,l,a){const m=w("BasicForm"),i=w("BasicModal");return A(),G(i,Z(s.$attrs,{onRegister:s.registerModal,title:s.getTitle,onOk:s.handleSubmit}),{default:I(()=>[W(m,{onRegister:s.registerForm},null,8,["onRegister"])]),_:1},16,["onRegister","title","onOk"])}const ge=z(H,[["render",J]]);export{ge as default};
