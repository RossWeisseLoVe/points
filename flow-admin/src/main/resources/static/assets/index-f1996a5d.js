import{_ as z}from"./BasicTable.vue_vue_type_script_setup_true_lang-68f7da80.js";import"./TableImg.vue_vue_type_style_index_0_lang-c025c7d6.js";import{a as N}from"./BasicForm.vue_vue_type_style_index_0_lang-1d0165cd.js";import{u as U}from"./useTable-dd83d9cb.js";import{g as V,a as k,d as W,b as K}from"./role-b83ceaa0.js";import{P as L}from"./index-5a8cda67.js";import H from"./CompanyTree-d7d2dbca.js";import{a as Q,c as Y}from"./index.js";import{b as I}from"./index-6bb63bf0.js";import{R as Z,s as x,c as j,p as q}from"./RoleModal-469c37ca.js";import G from"./index-d0acc860.js";import{e as J}from"./personal-9cdd6bd5.js";import{E as A,Q as X,bl as ee,Y as oe,aO as ne}from"./antd-bebda08e.js";import{d as ae,f as P,u as b,a6 as t,Z as F,a7 as $,a8 as l,l as a,E as C,aa as te,$ as O}from"./vue-f7f38239.js";import"./BasicForm.vue_vue_type_script_setup_true_lang-b5fd2c2d.js";import"./useForm-d2875f1c.js";import"./uuid-31b8b5a4.js";import"./sortable.esm-4ae27e0b.js";import"./onMountedOrActivated-a837e8fb.js";import"./useWindowSizeFn-01ffbee2.js";import"./index-1b9aa1da.js";import"./useSortable-9ec2a7be.js";import"./download-2647fd8d.js";import"./base64Conver-39fc0d26.js";import"./index-b34be3ab.js";import"./IconPicker.vue_vue_type_script_setup_true_lang-af62677b.js";import"./copyTextToClipboard-ad844e61.js";import"./index-091b1c05.js";import"./useContentViewHeight-4f74c208.js";import"./index-f9546e03.js";import"./useContextMenu-b66322cd.js";import"./company-7689c9fc.js";import"./constantEnum-c819fa5f.js";import"./OrgTree-95f059e8.js";import"./dept-92794b55.js";const{createMessage:le}=Q(),se=ae({name:"RoleManagement",components:{BasicTable:z,PageWrapper:L,CompanyTree:H,RoleModal:Z,PersonalSelector:G,TableAction:N,Input:A,Tag:X,Affix:ee,Space:oe,Search:A.Search,SettingOutlined:ne},setup(){const[n,{openModal:y}]=I(),[v,{openModal:D,setModalProps:E}]=I(),i=P({}),m=P([]),c=P({}),f=P({});x.forEach(e=>{e&&(e.componentProps.onkeypress=o=>{o.keyCode===13&&u()})});const[h,{reload:u}]=U({title:"列表",api:V,columns:j,formConfig:{labelWidth:120,schemas:x,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},expandRowByClick:!0,useSearchForm:!0,showIndexColumn:!1,showTableSetting:!1,bordered:!1,pagination:!0,onExpand:(e,o)=>{e?(i.value=o,c.value[o.id]="",d(o.id,c.value[o.id])):m.value=[]},rowKey:"id",canResize:!1});function g(){y(!0,{isUpdate:!1})}function w(e,o){o.stopPropagation(),y(!0,{record:e,isUpdate:!0})}function d(e,o){k({roleId:e,personal:{keyword:o||""}}).then(s=>{f.value[e]=s})}function S(e,o){o.stopPropagation(),i.value=e,k({roleId:e.id}).then(s=>{D(!0,{selectorProps:{multiSelect:!0,selectedList:s.map(M=>({code:M.code,name:M.name}))}}),E({title:`设置角色【${e.name}】下的人员`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}).finally(()=>{})}function R(e){if(e.children&&e.children.length>0){le.warning("有子节点，不能删除！");return}W([e.id]).then(o=>{u()})}function T(e){J({roleId:e.roleId,personalId:e.personalId}).then(()=>{d(e.roleId,"")})}function B(){setTimeout(()=>{u()},200)}function r(e,o){d(e,o)}function p(e){const o=e.map(s=>({id:s.id,code:s.code}));K({roleId:b(i).id,personalList:o}).then(()=>{m.value=[b(i).id],d(b(i).id,c.value[b(i).id])})}function _(e){u({searchInfo:{companyId:e?e.id:""}})}return{personalColumns:q,currentRole:i,rolePersonalData:f,onSearchPerson:r,searchPersonTxt:c,registerTable:h,registerModal:n,registerPersonalModal:v,handleCreate:g,handleEdit:w,handleAddPersonal:S,handleDelete:R,handleDeletePersonal:T,handleSuccess:B,handleSettingPersonalSuccess:p,handleSelect:_}}});const re={class:"manager-range",style:{"text-align":"right"}};function ie(n,y,v,D,E,i){const m=t("CompanyTree"),c=t("Affix"),f=t("a-button"),h=t("TableAction"),u=t("Search"),g=t("Tag"),w=t("Space"),d=t("SettingOutlined"),S=t("BasicTable"),R=t("RoleModal"),T=t("PersonalSelector"),B=t("PageWrapper");return F(),$(B,{dense:"",contentFullHeight:"",contentClass:"flex"},{default:l(()=>[a(c,{"offset-top":"8",class:"w-1/4 xl:w-1/5"},{default:l(()=>[a(m,{contentFullHeight:"",onSelect:n.handleSelect},null,8,["onSelect"])]),_:1}),a(S,{onRegister:n.registerTable,class:"personal w-3/4 xl:w-4/5"},{toolbar:l(()=>[a(f,{type:"primary",onClick:n.handleCreate},{default:l(()=>[C("新增")]),_:1},8,["onClick"])]),bodyCell:l(({column:r,record:p})=>[r.key==="action"?(F(),$(h,{key:0,actions:[{tooltip:"添加人员",icon:"ant-design:user-add",onClick:n.handleAddPersonal.bind(null,p)},{tooltip:"修改",icon:"clarity:note-edit-line",onClick:n.handleEdit.bind(null,p)},{tooltip:"删除",icon:"ant-design:delete-outlined",color:"error",onClick:_=>{_.stopPropagation()},popConfirm:{title:"是否确认删除",confirm:n.handleDelete.bind(null,p),placement:"left"}}]},null,8,["actions"])):te("",!0)]),expandedRowRender:l(({record:r,index:p,indent:_,expanded:e})=>[a(S,{title:"",size:"small",columns:n.personalColumns,useSearchForm:!1,immediate:!1,showIndexColumn:!0,showTableSetting:!1,bordered:!0,pagination:!1,actionColumn:`{\r
              align: 'center'\r
            }`,rowKey:"id",canResize:!1,searchInfo:{roleId:r.id},dataSource:n.rolePersonalData[r.id],class:"w-4/4 xl:w-5/5"},{customName:l(({rec:o})=>[O("span",null,[C(" 姓名 "),a(u,{value:n.searchPersonTxt[r.id],"onUpdate:value":s=>n.searchPersonTxt[r.id]=s,placeholder:"姓名/工号/手机",style:{width:"150px"},size:"small",allowClear:"",onSearch:s=>{n.onSearchPerson(r.id,s)}},null,8,["value","onUpdate:value","onSearch"])])]),action:l(({record:o})=>[a(h,{actions:[{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"是否确认删除",confirm:n.handleDeletePersonal.bind(null,o),placement:"left"}}]},null,8,["actions"])]),setManagerRange:l(({record:o})=>[O("div",re,[a(w,{size:"small"},{default:l(()=>[a(g,{color:"processing"},{default:l(()=>[C("中国石化")]),_:1}),a(g,{color:"processing"},{default:l(()=>[C("中国石化")]),_:1})]),_:1}),a(d,{class:"ant-btn-link"})])]),_:2},1032,["columns","searchInfo","dataSource"])]),_:1},8,["onRegister"]),a(R,{onRegister:n.registerModal,onSuccess:n.handleSuccess},null,8,["onRegister","onSuccess"]),a(T,{onRegister:n.registerPersonalModal,onSuccess:n.handleSettingPersonalSuccess},null,8,["onRegister","onSuccess"])]),_:1})}const Le=Y(se,[["render",ie]]);export{Le as default};
