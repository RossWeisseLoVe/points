var k=Object.defineProperty;var F=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var R=(e,t,a)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,b=(e,t)=>{for(var a in t||(t={}))L.call(t,a)&&R(e,a,t[a]);if(F)for(var a of F(t))O.call(t,a)&&R(e,a,t[a]);return e};var w=(e,t,a)=>new Promise((i,m)=>{var g=o=>{try{n(a.next(o))}catch(l){m(l)}},c=o=>{try{n(a.throw(o))}catch(l){m(l)}},n=o=>o.done?i(o.value):Promise.resolve(o.value).then(g,c);n((a=a.apply(e,t)).next())});import{B as S,a as A}from"./index-6bb63bf0.js";import{_ as I}from"./BasicForm.vue_vue_type_script_setup_true_lang-b5fd2c2d.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1d0165cd.js";import{u as C}from"./useForm-d2875f1c.js";import{a as j,c as q}from"./index.js";import{a as D}from"./account.data-83659400.js";import{c as J,s as z}from"./account-1d577ee4.js";import{F as G}from"./constantEnum-c819fa5f.js";import{d as T,f as N,u as f,c as Z,a6 as _,Z as y,a7 as W,a8 as v,l as M,_ as U,ab as H,a2 as K,a3 as Q,$ as X}from"./vue-f7f38239.js";import{au as Y,al as ee,at as ae}from"./antd-bebda08e.js";import"./useWindowSizeFn-01ffbee2.js";import"./index-1b9aa1da.js";import"./uuid-31b8b5a4.js";import"./useSortable-9ec2a7be.js";import"./download-2647fd8d.js";import"./base64Conver-39fc0d26.js";import"./index-b34be3ab.js";import"./IconPicker.vue_vue_type_script_setup_true_lang-af62677b.js";import"./copyTextToClipboard-ad844e61.js";import"./index-091b1c05.js";const se=T({name:"AccountModal",components:{BasicModal:S,BasicForm:I,PlusOutlined:Y,LoadingOutlined:ee,Upload:ae},emits:["success","register"],setup(e,{emit:t}){const a=N(!0),i=N(""),{createMessage:m}=j(),[g,{setFieldsValue:c,updateSchema:n,resetFields:o,validate:l}]=C({labelWidth:100,schemas:D,showActionButtonGroup:!1,actionColOptions:{span:23}}),u=s=>[{trigger:"blur",validator:(r,d)=>d?J({id:s.id,field:s.field,fieldValue:d,fieldName:s.fieldName}).then(p=>p?Promise.resolve():Promise.reject(s.fieldName+"已存在，请修改！")).catch(p=>Promise.reject(p)):Promise.resolve()}],[B,{setModalProps:h,closeModal:P}]=A(s=>w(this,null,function*(){yield o(),h({confirmLoading:!1}),a.value=!!(s!=null&&s.isUpdate);let r=s.record;yield n([{field:"username",dynamicRules:()=>[{required:!0,whitespace:!0,message:"用户名不能为空！"},{pattern:new RegExp(G.SN),type:"string",message:"请输入英文或数字！"},{max:30,message:"字符长度不能大于30！"},...u({id:f(a)&&r&&r.id||"",field:"username",fieldValue:"",fieldName:"用户名"})]},{field:"userNo",dynamicRules:()=>[{required:!0,whitespace:!0,message:"工号不能为空！"},{pattern:new RegExp("^[0-9a-zA-Z_]{1,}$"),type:"string",message:"请输入英文或数字！"},{max:32,message:"字符长度不能大于32！"},...u({id:f(a)&&r&&r.id||"",field:"userNo",fieldValue:"",fieldName:"工号"})]},{field:"mobile",dynamicRules:()=>[{required:!0,whitespace:!0,message:"手机不能为空！"},{pattern:new RegExp("^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$"),type:"string",message:"请输入正确的手机号！"},{max:32,message:"字符长度不能大于32！"},...u({id:f(a)&&r&&r.id||"",field:"mobile",fieldValue:"",fieldName:"手机号"})]},{field:"email",dynamicRules:()=>[{pattern:new RegExp("^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$"),type:"string",message:"请输入正确的邮箱地址！"},{max:256,message:"字符长度不能大于256！"},...u({id:f(a)&&r&&r.id||"",field:"email",fieldValue:"",fieldName:"邮箱"})]}]),i.value=s.record.image,c(b({},s.record))})),E=Z(()=>f(a)?"修改":"新增"),$=(s,r)=>{const d=new FileReader;d.addEventListener("load",()=>r(d.result)),d.readAsDataURL(s)},x=s=>s.type==="image/jpeg"||s.type==="image/png"?s.size/1024/1024<2?($(s,p=>{i.value=p}),!1):(m.error("图片不能大于2MB！"),!1):(m.error("只允许上传JPG图片！"),!1);function V(){return w(this,null,function*(){try{h({confirmLoading:!0});const s=yield l();s.image=i.value,yield z(s),P(),t("success")}finally{h({confirmLoading:!1})}})}return{registerModal:B,registerForm:g,getTitle:E,imageUrl:i,handleSubmit:V,beforeUpload:x}}});const te=e=>(K("data-v-69b8cfc1"),e=e(),Q(),e),re=["src"],oe={key:1},ie=te(()=>X("div",{class:"ant-upload-text"},"上传头像",-1));function ne(e,t,a,i,m,g){const c=_("plus-outlined"),n=_("Upload"),o=_("BasicForm"),l=_("BasicModal");return y(),W(l,H(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:v(()=>[M(o,{onRegister:e.registerForm,class:"accountForm"},{headImg:v(({model:u,field:B})=>[M(n,{style:{margin:"auto"},name:"avatar","list-type":"picture-card",class:"avatar-uploader","show-upload-list":!1,"before-upload":e.beforeUpload,multiple:!1},{default:v(()=>[e.imageUrl?(y(),U("img",{key:0,src:e.imageUrl,alt:"avatar",style:{width:"100px",height:"100px"}},null,8,re)):(y(),U("div",oe,[M(c),ie]))]),_:1},8,["before-upload"])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title","onOk"])}const Ee=q(se,[["render",ne],["__scopeId","data-v-69b8cfc1"]]);export{Ee as default};
