var X=Object.defineProperty;var Y=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var Z=(o,l,n)=>l in o?X(o,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[l]=n,V=(o,l)=>{for(var n in l||(l={}))ee.call(l,n)&&Z(o,n,l[n]);if(Y)for(var n of Y(l))oe.call(l,n)&&Z(o,n,l[n]);return o};var W=(o,l,n)=>new Promise((P,_)=>{var B=d=>{try{f(n.next(d))}catch(u){_(u)}},S=d=>{try{f(n.throw(d))}catch(u){_(u)}},f=d=>d.done?P(d.value):Promise.resolve(d.value).then(B,S);f((n=n.apply(o,l)).next())});import{_ as ne}from"./BasicTable.vue_vue_type_script_setup_true_lang-68f7da80.js";import"./TableImg.vue_vue_type_style_index_0_lang-c025c7d6.js";import{a as te}from"./BasicForm.vue_vue_type_style_index_0_lang-1d0165cd.js";import{u as ae}from"./useTable-dd83d9cb.js";import{g as le,a as ie,b as se,d as re,e as ce}from"./personal-9cdd6bd5.js";import{P as de}from"./index-5a8cda67.js";import ue from"./OrgTree-95f059e8.js";import{b as N}from"./index-6bb63bf0.js";import{P as pe,c as me,s as fe}from"./PersonalModal-b924d822.js";import ge from"./index-d001b873.js";import he from"./index-d0acc860.js";import{G as _e,Y as Se,a1 as be,aT as ye,P as ve,Q as Ce,ar as we,b1 as Re,br as Pe,bs as Be,bt as Ie}from"./antd-bebda08e.js";import{d as Te,f as w,u as c,a6 as t,Z as m,a7 as R,a8 as p,l as r,E as x,aa as U,_ as H,F as j,a0 as q,a9 as Me}from"./vue-f7f38239.js";import{c as ke}from"./index.js";import"./BasicForm.vue_vue_type_script_setup_true_lang-b5fd2c2d.js";import"./useForm-d2875f1c.js";import"./uuid-31b8b5a4.js";import"./sortable.esm-4ae27e0b.js";import"./onMountedOrActivated-a837e8fb.js";import"./useWindowSizeFn-01ffbee2.js";import"./index-1b9aa1da.js";import"./useSortable-9ec2a7be.js";import"./download-2647fd8d.js";import"./base64Conver-39fc0d26.js";import"./index-b34be3ab.js";import"./IconPicker.vue_vue_type_script_setup_true_lang-af62677b.js";import"./copyTextToClipboard-ad844e61.js";import"./index-091b1c05.js";import"./useContentViewHeight-4f74c208.js";import"./index-f9546e03.js";import"./useContextMenu-b66322cd.js";import"./dept-92794b55.js";import"./jobGrade-6d36c665.js";import"./positionInfo-e2730662.js";import"./company-7689c9fc.js";import"./constantEnum-c819fa5f.js";import"./role-b83ceaa0.js";import"./CompanyTree-d7d2dbca.js";const De=Te({name:"PersonalManagement",components:{BasicTable:ne,Spin:_e,Space:Se,PageWrapper:de,OrgTree:ue,PersonalModal:pe,RoleSelector:ge,PersonalSelector:he,TableAction:te,Avatar:be,Badge:ye,Popconfirm:ve,Tag:Ce,Image:we,DeleteOutlined:Re,ManOutlined:Pe,WomanOutlined:Be,UserOutlined:Ie},setup(){const[o,{openModal:l,setModalProps:n}]=N(),[P,{openModal:_,setModalProps:B}]=N(),[S,{openModal:f,setModalProps:d}]=N(),u=w({}),b=w({}),I=w(""),y=w(!1),a=w({}),[M,{reload:h,setLoading:z}]=ae({title:"列表",api:le,columns:me,formConfig:{labelWidth:120,schemas:fe,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},searchInfo:{showRoles:!0},size:"small",useSearchForm:!0,showIndexColumn:!1,bordered:!0,actionColumn:{width:120,title:"操作",dataIndex:"action"},beforeFetch:e=>{var g,Q;let i={};return((g=a.value)==null?void 0:g.sourceType)==="1"?i={companyId:c(a).id}:((Q=a.value)==null?void 0:Q.sourceType)==="2"&&(i={deptId:c(a).id}),V(V({},e),i)}});function k(){let e={};c(a)&&(c(a).sourceType==="1"?e={companyId:c(a).id}:c(a).sourceType==="2"&&(e={companyId:c(a).companyId,deptId:c(a).id})),l(!0,{isUpdate:!1,record:e}),n({title:"新增人员",bodyStyle:{padding:"0px",margin:"0px"},width:800,height:400})}function D(e){l(!0,{record:e,isUpdate:!0}),n({title:"修改人员",bodyStyle:{padding:"0px",margin:"0px"},width:800,height:420})}function O(e){u.value=e,_(!0,{personalId:u.value.id}),B({title:`给【${e.name}(${e.code})】添加角色`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}function E(e){u.value=e;let i=[];e.leaderCode&&e.leaderName&&i.push({id:e.id,code:e.leaderCode,name:e.leaderName}),f(!0,{selectorProps:{multiSelect:!1,selectedList:i}}),d({title:`给【${e.name}(${e.code})】设置领导`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}function L(e){return W(this,null,function*(){const i=e.map(g=>({id:g.id}));yield ie({personalId:c(u).id,roles:i}),T()})}function A(e){return W(this,null,function*(){e&&e.length>0&&se({leaderCode:e[0].code,id:c(u).id}).then(()=>{T()}).finally(()=>{})})}function F(e){re([e.id]).then(i=>{h()})}function $(){h()}function v(){setTimeout(()=>{h()},200)}function s(){}function C(e){e&&(I.value=e,y.value=!0)}function G(e,i){y.value=e}function J(e,i){b.value[e]=!0,ce({personalId:e,roleId:i}).then(()=>{T()}).finally(()=>{b.value[e]=!1})}function T(){var i,g;let e={};((i=a.value)==null?void 0:i.sourceType)==="1"?e={companyId:c(a).id}:((g=a.value)==null?void 0:g.sourceType)==="2"&&(e={deptId:c(a).id}),h({searchInfo:e})}function K(e){a.value=e,T()}return{registerTable:M,registerRoleModal:P,registerPersonalModal:S,registerModal:o,deleteRoleLoading:b,previewImage:I,previewImageVisible:y,previewImageHandle:C,previewImageVisibleChange:G,handleCreate:k,handleEdit:D,confirmDeleteRole:J,cancelDeleteRole:s,handleSettingRoles:O,handleSettingLeader:E,handleDelete:F,handleSuccess:v,handleSettingRoleSuccess:L,handleSettingLeaderSuccess:A,handleSelect:K,doSearch:$}}});const Oe={key:2,class:"personal-roles"};function Ee(o,l,n,P,_,B){const S=t("OrgTree"),f=t("a-button"),d=t("TableAction"),u=t("WomanOutlined"),b=t("ManOutlined"),I=t("UserOutlined"),y=t("Avatar"),a=t("Badge"),M=t("DeleteOutlined"),h=t("Popconfirm"),z=t("Tag"),k=t("Space"),D=t("Spin"),O=t("BasicTable"),E=t("Image"),L=t("PersonalModal"),A=t("RoleSelector"),F=t("PersonalSelector"),$=t("PageWrapper");return m(),R($,{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex"},{default:p(()=>[r(S,{class:"w-1/4 xl:w-1/5",onSelect:o.handleSelect},null,8,["onSelect"]),r(O,{onRegister:o.registerTable,class:"w-3/4 xl:w-4/5"},{toolbar:p(()=>[r(f,{type:"primary",onClick:o.handleCreate},{default:p(()=>[x("新增")]),_:1},8,["onClick"])]),bodyCell:p(({column:v,record:s})=>[v.key==="action"?(m(),R(d,{key:0,actions:[{tooltip:"修改",icon:"clarity:note-edit-line",onClick:o.handleEdit.bind(null,s)},{tooltip:"删除",icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"是否确认删除",confirm:o.handleDelete.bind(null,s),placement:"left"}}],dropDownActions:[{label:"分配角色",title:"分配角色",icon:"ant-design:usergroup-add",onClick:o.handleSettingRoles.bind(null,s)},{title:"设置领导",label:"设置领导",icon:"ant-design:setting-outlined",onClick:o.handleSettingLeader.bind(null,s)}]},null,8,["actions","dropDownActions"])):U("",!0),v.key==="name"?(m(),H(j,{key:1},[r(a,null,{count:p(()=>[s.sex===2?(m(),R(u,{key:0,style:{color:"#f5222d","font-size":"12px"}})):(m(),R(b,{key:1,style:{color:"#1890ff","font-size":"12px"}}))]),default:p(()=>[r(y,{src:s.headImg,onClick:C=>o.previewImageHandle(s.headImg)},{icon:p(()=>[r(I)]),_:2},1032,["src","onClick"])]),_:2},1024),x(" "+q(s.name),1)],64)):U("",!0),v.key==="roles"?(m(),H("div",Oe,[r(D,{spinning:o.deleteRoleLoading&&o.deleteRoleLoading[s.id]?o.deleteRoleLoading[s.id]:!1},{default:p(()=>[r(k,null,{default:p(()=>[(m(!0),H(j,null,Me(s.roles,C=>(m(),R(z,{class:"role-item"},{default:p(()=>[x(q(C.name)+" ",1),r(h,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:G=>o.confirmDeleteRole(s.id,C.id),onCancel:o.cancelDeleteRole},{default:p(()=>[r(M,{color:"error",style:{color:"#d9595b"}})]),_:2},1032,["onConfirm","onCancel"])]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["spinning"])])):U("",!0)]),_:1},8,["onRegister"]),r(E,{width:0,height:0,src:o.previewImage,preview:{visible:o.previewImageVisible,onVisibleChange:o.previewImageVisibleChange}},null,8,["src","preview"]),r(L,{onRegister:o.registerModal,onSuccess:o.handleSuccess},null,8,["onRegister","onSuccess"]),r(A,{onRegister:o.registerRoleModal,onSuccess:o.handleSettingRoleSuccess},null,8,["onRegister","onSuccess"]),r(F,{onRegister:o.registerPersonalModal,onSuccess:o.handleSettingLeaderSuccess},null,8,["onRegister","onSuccess"])]),_:1})}const yo=ke(De,[["render",Ee]]);export{yo as default};
