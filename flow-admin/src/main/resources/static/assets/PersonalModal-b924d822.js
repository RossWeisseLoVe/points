var E=Object.defineProperty;var D=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var M=(e,a,t)=>a in e?E(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,h=(e,a)=>{for(var t in a||(a={}))L.call(a,t)&&M(e,t,a[t]);if(D)for(var t of D(a))G.call(a,t)&&M(e,t,a[t]);return e};var I=(e,a,t)=>new Promise((l,d)=>{var f=r=>{try{s(t.next(r))}catch(c){d(c)}},p=r=>{try{s(t.throw(r))}catch(c){d(c)}},s=r=>r.done?l(r.value):Promise.resolve(r.value).then(f,p);s((t=t.apply(e,a)).next())});import{B as V,a as A}from"./index-6bb63bf0.js";import{_ as J}from"./BasicForm.vue_vue_type_script_setup_true_lang-b5fd2c2d.js";import"./BasicForm.vue_vue_type_style_index_0_lang-1d0165cd.js";import{u as z}from"./useForm-d2875f1c.js";import{a as N}from"./jobGrade-6d36c665.js";import{g as R}from"./positionInfo-e2730662.js";import{a2 as W,ay as Q,a as Z,c as H}from"./index.js";import{g as S}from"./company-7689c9fc.js";import{m as K,d as X,f as B,u as b,c as Y,a6 as g,Z as w,a7 as ee,a8 as _,l as y,_ as C,ab as te,a2 as oe,a3 as ae,$ as se}from"./vue-f7f38239.js";import{Q as re,au as ne,al as le,at as ie}from"./antd-bebda08e.js";import{g as v}from"./dept-92794b55.js";import{c as de,s as pe}from"./personal-9cdd6bd5.js";import{F as ce}from"./constantEnum-c819fa5f.js";const Ue=[{title:"姓名",dataIndex:"name",width:120,align:"left"},{title:"工号",dataIndex:"code",width:100,align:"left"},{title:"状态",dataIndex:"status",width:60,customRender:({record:e})=>{const t=~~e.status===1,l=t?"green":"red",d=t?"在职":"离职";return K(re,{color:l},()=>d)}},{title:"邮箱",dataIndex:"email",width:120,align:"left"},{title:"手机",dataIndex:"mobile",width:120,align:"left"},{title:"部门",dataIndex:"deptName",width:120,align:"left"},{title:"公司",dataIndex:"companyName",width:120,align:"left"},{title:"上级领导",dataIndex:"leaderName",width:140,align:"left",customRender:({record:e})=>e.leaderCode?`${e.leaderName||""}[${e.leaderCode}]`:"未设置"},{title:"角色",dataIndex:"roles",width:300,align:"left"},{title:"离职日期",dataIndex:"leaveDate",width:100,customRender:({text:e})=>e?W(e):""},{title:"创建时间",dataIndex:"createTime",width:130,customRender:({text:e})=>e?Q(e):""}],$e=[{field:"keyword",label:"关键字",component:"Input",componentProps:{placeholder:"请输入姓名/工号/手机/邮箱"},labelWidth:60,colProps:{span:8,lg:{span:8,offset:0},sm:{span:14,offset:0},xs:{span:16,offset:0}}}],me=[{field:"id",label:"ID",required:!1,component:"Input",show:!1},{field:"name",label:"姓名",component:"Input",required:!0,colProps:{span:9},rules:[{required:!0,whitespace:!0,message:"姓名不能为空！"},{max:20,message:"字符长度不能大于20！"}]},{field:"code",label:"工号",component:"Input",required:!0,colProps:{span:9}},{field:"headImg",label:"",component:"Input",slot:"headImg",colProps:{style:"margin: auto;position: absolute;right: 0;",span:4}},{label:"手机",field:"mobile",component:"Input",required:!0,colProps:{span:9},rules:[{required:!0,whitespace:!0,message:"手机不能为空！"},{pattern:new RegExp("^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$"),type:"string",message:"请输入正确的手机号！"},{max:32,message:"字符长度不能大于32！"}]},{label:"邮箱",field:"email",component:"Input",colProps:{span:9},rules:[{pattern:new RegExp("^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$"),type:"string",message:"请输入正确的邮箱地址！"},{max:256,message:"字符长度不能大于256！"}]},{field:"sex",label:"性别",component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:"男",value:1},{label:"女",value:2}]},colProps:{span:9}},{field:"status",label:"在职状态",component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:"在职",value:1},{label:"离职",value:0}]},colProps:{span:9}},{field:"jobGradeCode",label:"职级",component:"ApiTreeSelect",colProps:{span:12},componentProps:{api:N,treeNodeFilterProp:"showName",getPopupContainer:()=>document.body}},{field:"positionCode",label:"岗位",component:"ApiTreeSelect",colProps:{span:12},componentProps:{api:R,treeNodeFilterProp:"showName",getPopupContainer:()=>document.body}},{field:"companyId",label:"所属公司",component:"ApiTreeSelect",colProps:{span:12},componentProps:{api:S,treeNodeFilterProp:"cname",getPopupContainer:()=>document.body},required:!0},{field:"deptId",label:"所属部门",component:"TreeSelect",colProps:{span:12},componentProps:{treeNodeFilterProp:"name",getPopupContainer:()=>document.body},required:!0},{label:"地址",field:"address",component:"InputTextArea",rules:[{max:400,message:"字符长度不能大于400！"}],colProps:{span:24}}],ue=X({name:"PersonalModal",components:{BasicModal:V,BasicForm:J,PlusOutlined:ne,LoadingOutlined:le,Upload:ie},emits:["success","register"],setup(e,{emit:a}){const t=B(!0),l=B(""),{createMessage:d}=Z(),[f,{setFieldsValue:p,updateSchema:s,resetFields:r,validate:c}]=z({labelWidth:100,schemas:me,showActionButtonGroup:!1,actionColOptions:{span:23}}),x=o=>[{trigger:"blur",validator:(u,i)=>i?de({id:o.id,field:o.field,fieldValue:i,fieldName:o.fieldName}).then(n=>n?Promise.resolve():Promise.reject(o.fieldName+"已存在，请修改！")).catch(n=>Promise.reject(n)):Promise.resolve()}],[F,{setModalProps:P,closeModal:U,changeLoading:T}]=A(o=>I(this,null,function*(){T(!0),r(),P({confirmLoading:!1}),t.value=!!(o!=null&&o.isUpdate),yield S();const u=yield N(),i=yield R();let n=o.record;if(yield s({field:"companyId",componentProps:{onChange:m=>{s([{field:"deptId",componentProps:{treeData:[]}}]),p({deptId:""}),m&&v({companyId:m}).then(q=>{s([{field:"deptId",componentProps:{treeData:q}}])})}}}),yield s([{field:"jobGradeCode",componentProps:{treeData:u}},{field:"positionCode",componentProps:{treeData:i}},{field:"code",dynamicRules:()=>[{required:!0,whitespace:!0,message:"工号不能为空！"},{pattern:new RegExp(ce.SN),type:"string",message:"请输入英文或数字！"},{max:32,message:"字符长度不能大于32！"},...x({id:b(t)&&n&&n.id||"",field:"code",fieldValue:"",fieldName:"工号"})]}]),b(t)){const m=yield v({companyId:o.record.companyId});s([{field:"deptId",componentProps:{treeData:m}}]),p(h({},o.record)),l.value=o.record.headImg}else{if(n.companyId){const m=yield v({companyId:n.companyId});s([{field:"deptId",componentProps:{treeData:m}}]),p(h({},n))}l.value=""}T(!1)})),$=Y(()=>b(t)?"编辑":"新增"),O=(o,u)=>{const i=new FileReader;i.addEventListener("load",()=>u(i.result)),i.readAsDataURL(o)},j=o=>o.type==="image/jpeg"||o.type==="image/png"?o.size/1024/1024<2?(O(o,n=>{l.value=n}),!1):(d.error("图片不能大于2MB！"),!1):(d.error("只允许上传JPG图片！"),!1);function k(){return I(this,null,function*(){try{P({confirmLoading:!0});const o=yield c();o.headImg=l.value,yield pe(o),U(),a("success")}finally{P({confirmLoading:!1})}})}return{registerModal:F,registerForm:f,getTitle:$,imageUrl:l,handleSubmit:k,beforeUpload:j}}});const fe=e=>(oe("data-v-d74e8416"),e=e(),ae(),e),ge=["src"],Pe={key:1},he=fe(()=>se("div",{class:"ant-upload-text"},"上传头像",-1));function Ie(e,a,t,l,d,f){const p=g("plus-outlined"),s=g("Upload"),r=g("BasicForm"),c=g("BasicModal");return w(),ee(c,te(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:_(()=>[y(r,{onRegister:e.registerForm,class:"personalForm"},{headImg:_(({model:x,field:F})=>[y(s,{style:{margin:"auto"},name:"avatar","list-type":"picture-card",class:"avatar-uploader","show-upload-list":!1,"before-upload":e.beforeUpload,multiple:!1},{default:_(()=>[e.imageUrl?(w(),C("img",{key:0,src:e.imageUrl,alt:"avatar",style:{width:"100px",height:"100px"}},null,8,ge)):(w(),C("div",Pe,[y(p),he]))]),_:1},8,["before-upload"])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title","onOk"])}const be=H(ue,[["render",Ie],["__scopeId","data-v-d74e8416"]]),Oe=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{be as P,Oe as a,Ue as c,$e as s};
